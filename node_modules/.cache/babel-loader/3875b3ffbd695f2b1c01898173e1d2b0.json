{"ast":null,"code":"/**\n * Create a new [Mapbox GL JS plugin](https://www.mapbox.com/blog/build-mapbox-gl-js-plugins/) that\n * modifies the layers of the map style to use the 'text-field' that matches the browser language.\n * @constructor\n * @param {object} options - Options to configure the plugin.\n * @param {string[]} [options.supportedLanguages] - List of supported languages\n * @param {Function} [options.languageTransform] - Custom style transformation to apply\n * @param {RegExp} [options.languageField=/^\\{name/] - RegExp to match if a text-field is a language field\n * @param {Function} [options.getLanguageField] - Given a language choose the field in the vector tiles\n * @param {string} [options.languageSource] - Name of the source that contains the different languages.\n * @param {string} [options.defaultLanguage] - Name of the default language to initialize style after loading.\n * @param {string[]} [options.excludedLayerIds] - Name of the layers that should be excluded from translation.\n */\nfunction MapboxLanguage(options) {\n  options = Object.assign({}, options);\n\n  if (!(this instanceof MapboxLanguage)) {\n    throw new Error('MapboxLanguage needs to be called with the new keyword');\n  }\n\n  this.setLanguage = this.setLanguage.bind(this);\n  this._initialStyleUpdate = this._initialStyleUpdate.bind(this);\n  this._defaultLanguage = options.defaultLanguage;\n  this._isLanguageField = options.languageField || /^\\{name/;\n\n  this._getLanguageField = options.getLanguageField || function nameField(language) {\n    return language === 'mul' ? '{name}' : '{name_' + language + '}';\n  };\n\n  this._languageSource = options.languageSource || null;\n\n  this._languageTransform = options.languageTransform || function (style, language) {\n    if (language === 'ar') {\n      return noSpacing(style);\n    } else {\n      return standardSpacing(style);\n    }\n  };\n\n  this._excludedLayerIds = options.excludedLayerIds || [];\n  this.supportedLanguages = options.supportedLanguages || ['ar', 'en', 'es', 'fr', 'de', 'ja', 'ko', 'mul', 'pt', 'ru', 'zh'];\n}\n\nfunction standardSpacing(style) {\n  var changedLayers = style.layers.map(function (layer) {\n    if (!(layer.layout || {})['text-field']) return layer;\n    var spacing = 0;\n\n    if (layer['source-layer'] === 'state_label') {\n      spacing = 0.15;\n    }\n\n    if (layer['source-layer'] === 'marine_label') {\n      if (/-lg/.test(layer.id)) {\n        spacing = 0.25;\n      }\n\n      if (/-md/.test(layer.id)) {\n        spacing = 0.15;\n      }\n\n      if (/-sm/.test(layer.id)) {\n        spacing = 0.1;\n      }\n    }\n\n    if (layer['source-layer'] === 'place_label') {\n      if (/-suburb/.test(layer.id)) {\n        spacing = 0.15;\n      }\n\n      if (/-neighbour/.test(layer.id)) {\n        spacing = 0.1;\n      }\n\n      if (/-islet/.test(layer.id)) {\n        spacing = 0.01;\n      }\n    }\n\n    if (layer['source-layer'] === 'airport_label') {\n      spacing = 0.01;\n    }\n\n    if (layer['source-layer'] === 'rail_station_label') {\n      spacing = 0.01;\n    }\n\n    if (layer['source-layer'] === 'poi_label') {\n      if (/-scalerank/.test(layer.id)) {\n        spacing = 0.01;\n      }\n    }\n\n    if (layer['source-layer'] === 'road_label') {\n      if (/-label-/.test(layer.id)) {\n        spacing = 0.01;\n      }\n\n      if (/-shields/.test(layer.id)) {\n        spacing = 0.05;\n      }\n    }\n\n    return Object.assign({}, layer, {\n      layout: Object.assign({}, layer.layout, {\n        'text-letter-spacing': spacing\n      })\n    });\n  });\n  return Object.assign({}, style, {\n    layers: changedLayers\n  });\n}\n\nfunction noSpacing(style) {\n  var changedLayers = style.layers.map(function (layer) {\n    if (!(layer.layout || {})['text-field']) return layer;\n    var spacing = 0;\n    return Object.assign({}, layer, {\n      layout: Object.assign({}, layer.layout, {\n        'text-letter-spacing': spacing\n      })\n    });\n  });\n  return Object.assign({}, style, {\n    layers: changedLayers\n  });\n}\n\nfunction isNameStringField(isLangField, property) {\n  return typeof property === 'string' && isLangField.test(property);\n}\n\nfunction isNameFunctionField(isLangField, property) {\n  return property.stops && property.stops.filter(function (stop) {\n    return isLangField.test(stop[1]);\n  }).length > 0;\n}\n\nfunction adaptPropertyLanguage(isLangField, property, languageFieldName) {\n  if (isNameStringField(isLangField, property)) return languageFieldName;\n\n  if (isNameFunctionField(isLangField, property)) {\n    var newStops = property.stops.map(function (stop) {\n      if (isLangField.test(stop[1])) {\n        return [stop[0], languageFieldName];\n      }\n\n      return stop;\n    });\n    return Object.assign({}, property, {\n      stops: newStops\n    });\n  }\n\n  return property;\n}\n\nfunction changeLayerTextProperty(isLangField, layer, languageFieldName, excludedLayerIds) {\n  if (layer.layout && layer.layout['text-field'] && excludedLayerIds.indexOf(layer.id) === -1) {\n    return Object.assign({}, layer, {\n      layout: Object.assign({}, layer.layout, {\n        'text-field': adaptPropertyLanguage(isLangField, layer.layout['text-field'], languageFieldName)\n      })\n    });\n  }\n\n  return layer;\n}\n\nfunction findStreetsSource(style) {\n  var sources = Object.keys(style.sources).filter(function (sourceName) {\n    var source = style.sources[sourceName];\n    return /mapbox-streets-v\\d/.test(source.url);\n  });\n  return sources[0];\n}\n/**\n * Explicitly change the language for a style.\n * @param {object} style - Mapbox GL style to modify\n * @param {string} language - The language iso code\n * @returns {object} the modified style\n */\n\n\nMapboxLanguage.prototype.setLanguage = function (style, language) {\n  if (this.supportedLanguages.indexOf(language) < 0) throw new Error('Language ' + language + ' is not supported');\n  var streetsSource = this._languageSource || findStreetsSource(style);\n  if (!streetsSource) return style;\n\n  var field = this._getLanguageField(language);\n\n  var isLangField = this._isLanguageField;\n  var excludedLayerIds = this._excludedLayerIds;\n  var changedLayers = style.layers.map(function (layer) {\n    if (layer.source === streetsSource) return changeLayerTextProperty(isLangField, layer, field, excludedLayerIds);\n    return layer;\n  });\n  var languageStyle = Object.assign({}, style, {\n    layers: changedLayers\n  });\n  return this._languageTransform(languageStyle, language);\n};\n\nMapboxLanguage.prototype._initialStyleUpdate = function () {\n  var style = this._map.getStyle();\n\n  var language = this._defaultLanguage || browserLanguage(this.supportedLanguages); // We only update the style once\n\n  this._map.off('styledata', this._initialStyleUpdate);\n\n  this._map.setStyle(this.setLanguage(style, language));\n};\n\nfunction browserLanguage(supportedLanguages) {\n  var language = navigator.languages ? navigator.languages[0] : navigator.language || navigator.userLanguage;\n  var parts = language.split('-');\n  var languageCode = language;\n\n  if (parts.length > 1) {\n    languageCode = parts[0];\n  }\n\n  if (supportedLanguages.indexOf(languageCode) > -1) {\n    return languageCode;\n  }\n\n  return null;\n}\n\nMapboxLanguage.prototype.onAdd = function (map) {\n  this._map = map;\n\n  this._map.on('styledata', this._initialStyleUpdate);\n\n  this._container = document.createElement('div');\n  return this._container;\n};\n\nMapboxLanguage.prototype.onRemove = function () {\n  this._map.off('styledata', this._initialStyleUpdate);\n\n  this._map = undefined;\n};\n\nfunction ie11Polyfill() {\n  if (typeof Object.assign != 'function') {\n    // Must be writable: true, enumerable: false, configurable: true\n    Object.defineProperty(Object, 'assign', {\n      // eslint-disable-next-line no-unused-vars\n      value: function assign(target, varArgs) {\n        // .length of function is 2\n        // eslint-disable-next-line strict\n        'use strict';\n\n        if (target === null) {\n          // TypeError if undefined or null\n          throw new TypeError('Cannot convert undefined or null to object');\n        }\n\n        var to = Object(target);\n\n        for (var index = 1; index < arguments.length; index++) {\n          var nextSource = arguments[index];\n\n          if (nextSource !== null) {\n            // Skip over if undefined or null\n            for (var nextKey in nextSource) {\n              // Avoid bugs when hasOwnProperty is shadowed\n              if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n                to[nextKey] = nextSource[nextKey];\n              }\n            }\n          }\n        }\n\n        return to;\n      },\n      writable: true,\n      configurable: true\n    });\n  }\n}\n\nif (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\n  module.exports = MapboxLanguage;\n} else {\n  ie11Polyfill();\n  window.MapboxLanguage = MapboxLanguage;\n}","map":{"version":3,"sources":["C:/wamp64/www/my-app/node_modules/@mapbox/mapbox-gl-language/index.js"],"names":["MapboxLanguage","options","Object","assign","Error","setLanguage","bind","_initialStyleUpdate","_defaultLanguage","defaultLanguage","_isLanguageField","languageField","_getLanguageField","getLanguageField","nameField","language","_languageSource","languageSource","_languageTransform","languageTransform","style","noSpacing","standardSpacing","_excludedLayerIds","excludedLayerIds","supportedLanguages","changedLayers","layers","map","layer","layout","spacing","test","id","isNameStringField","isLangField","property","isNameFunctionField","stops","filter","stop","length","adaptPropertyLanguage","languageFieldName","newStops","changeLayerTextProperty","indexOf","findStreetsSource","sources","keys","sourceName","source","url","prototype","streetsSource","field","languageStyle","_map","getStyle","browserLanguage","off","setStyle","navigator","languages","userLanguage","parts","split","languageCode","onAdd","on","_container","document","createElement","onRemove","undefined","ie11Polyfill","defineProperty","value","target","varArgs","TypeError","to","index","arguments","nextSource","nextKey","hasOwnProperty","call","writable","configurable","module","exports","window"],"mappings":"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","sourcesContent":["/**\n * Create a new [Mapbox GL JS plugin](https://www.mapbox.com/blog/build-mapbox-gl-js-plugins/) that\n * modifies the layers of the map style to use the 'text-field' that matches the browser language.\n * @constructor\n * @param {object} options - Options to configure the plugin.\n * @param {string[]} [options.supportedLanguages] - List of supported languages\n * @param {Function} [options.languageTransform] - Custom style transformation to apply\n * @param {RegExp} [options.languageField=/^\\{name/] - RegExp to match if a text-field is a language field\n * @param {Function} [options.getLanguageField] - Given a language choose the field in the vector tiles\n * @param {string} [options.languageSource] - Name of the source that contains the different languages.\n * @param {string} [options.defaultLanguage] - Name of the default language to initialize style after loading.\n * @param {string[]} [options.excludedLayerIds] - Name of the layers that should be excluded from translation.\n */\nfunction MapboxLanguage(options) {\n  options = Object.assign({}, options);\n  if (!(this instanceof MapboxLanguage)) {\n    throw new Error('MapboxLanguage needs to be called with the new keyword');\n  }\n\n  this.setLanguage = this.setLanguage.bind(this);\n  this._initialStyleUpdate = this._initialStyleUpdate.bind(this);\n\n  this._defaultLanguage = options.defaultLanguage;\n  this._isLanguageField = options.languageField || /^\\{name/;\n  this._getLanguageField = options.getLanguageField || function nameField(language) {\n    return language === 'mul' ? '{name}' : '{name_' + language + '}';\n  };\n  this._languageSource = options.languageSource || null;\n  this._languageTransform = options.languageTransform || function (style, language) {\n    if (language === 'ar') {\n      return noSpacing(style);\n    } else {\n      return standardSpacing(style);\n    }\n  };\n  this._excludedLayerIds = options.excludedLayerIds || [];\n  this.supportedLanguages = options.supportedLanguages || ['ar', 'en', 'es', 'fr', 'de', 'ja', 'ko', 'mul', 'pt', 'ru', 'zh'];\n}\n\nfunction standardSpacing(style) {\n  var changedLayers = style.layers.map(function (layer) {\n    if (!(layer.layout || {})['text-field']) return layer;\n    var spacing = 0;\n    if (layer['source-layer'] === 'state_label') {\n      spacing = 0.15;\n    }\n    if (layer['source-layer'] === 'marine_label') {\n      if (/-lg/.test(layer.id)) {\n        spacing = 0.25;\n      }\n      if (/-md/.test(layer.id)) {\n        spacing = 0.15;\n      }\n      if (/-sm/.test(layer.id)) {\n        spacing = 0.1;\n      }\n    }\n    if (layer['source-layer'] === 'place_label') {\n      if (/-suburb/.test(layer.id)) {\n        spacing = 0.15;\n      }\n      if (/-neighbour/.test(layer.id)) {\n        spacing = 0.1;\n      }\n      if (/-islet/.test(layer.id)) {\n        spacing = 0.01;\n      }\n    }\n    if (layer['source-layer'] === 'airport_label') {\n      spacing = 0.01;\n    }\n    if (layer['source-layer'] === 'rail_station_label') {\n      spacing = 0.01;\n    }\n    if (layer['source-layer'] === 'poi_label') {\n      if (/-scalerank/.test(layer.id)) {\n        spacing = 0.01;\n      }\n    }\n    if (layer['source-layer'] === 'road_label') {\n      if (/-label-/.test(layer.id)) {\n        spacing = 0.01;\n      }\n      if (/-shields/.test(layer.id)) {\n        spacing = 0.05;\n      }\n    }\n    return Object.assign({}, layer, {\n      layout: Object.assign({}, layer.layout, {\n        'text-letter-spacing': spacing\n      })\n    });\n  });\n\n  return Object.assign({}, style, {\n    layers: changedLayers\n  });\n}\n\nfunction noSpacing(style) {\n  var changedLayers = style.layers.map(function (layer) {\n    if (!(layer.layout || {})['text-field']) return layer;\n    var spacing = 0;\n    return Object.assign({}, layer, {\n      layout: Object.assign({}, layer.layout, {\n        'text-letter-spacing': spacing\n      })\n    });\n  });\n\n  return Object.assign({}, style, {\n    layers: changedLayers\n  });\n}\n\nfunction isNameStringField(isLangField, property) {\n  return typeof property === 'string' && isLangField.test(property);\n}\n\nfunction isNameFunctionField(isLangField, property) {\n  return property.stops && property.stops.filter(function (stop) {\n    return isLangField.test(stop[1]);\n  }).length > 0;\n}\n\nfunction adaptPropertyLanguage(isLangField, property, languageFieldName) {\n  if (isNameStringField(isLangField, property)) return languageFieldName;\n  if (isNameFunctionField(isLangField, property)) {\n    var newStops = property.stops.map(function (stop) {\n      if (isLangField.test(stop[1])) {\n        return [stop[0], languageFieldName];\n      }\n      return stop;\n    });\n    return Object.assign({}, property, {\n      stops: newStops\n    });\n  }\n  return property;\n}\n\nfunction changeLayerTextProperty(isLangField, layer, languageFieldName, excludedLayerIds) {\n  if (layer.layout && layer.layout['text-field'] && excludedLayerIds.indexOf(layer.id) === -1) {\n    return Object.assign({}, layer, {\n      layout: Object.assign({}, layer.layout, {\n        'text-field': adaptPropertyLanguage(isLangField, layer.layout['text-field'], languageFieldName)\n      })\n    });\n  }\n  return layer;\n}\n\nfunction findStreetsSource(style) {\n  var sources = Object.keys(style.sources).filter(function (sourceName) {\n    var source = style.sources[sourceName];\n    return /mapbox-streets-v\\d/.test(source.url);\n  });\n  return sources[0];\n}\n\n/**\n * Explicitly change the language for a style.\n * @param {object} style - Mapbox GL style to modify\n * @param {string} language - The language iso code\n * @returns {object} the modified style\n */\nMapboxLanguage.prototype.setLanguage = function (style, language) {\n  if (this.supportedLanguages.indexOf(language) < 0) throw new Error('Language ' + language + ' is not supported');\n  var streetsSource = this._languageSource || findStreetsSource(style);\n  if (!streetsSource) return style;\n\n  var field = this._getLanguageField(language);\n  var isLangField = this._isLanguageField;\n  var excludedLayerIds = this._excludedLayerIds;\n  var changedLayers = style.layers.map(function (layer) {\n    if (layer.source === streetsSource) return changeLayerTextProperty(isLangField, layer, field, excludedLayerIds);\n    return layer;\n  });\n\n  var languageStyle = Object.assign({}, style, {\n    layers: changedLayers\n  });\n\n  return this._languageTransform(languageStyle, language);\n};\n\nMapboxLanguage.prototype._initialStyleUpdate = function () {\n  var style = this._map.getStyle();\n  var language = this._defaultLanguage || browserLanguage(this.supportedLanguages);\n\n  // We only update the style once\n  this._map.off('styledata', this._initialStyleUpdate);\n  this._map.setStyle(this.setLanguage(style, language));\n};\n\nfunction browserLanguage(supportedLanguages) {\n  var language = navigator.languages ? navigator.languages[0] : (navigator.language || navigator.userLanguage);\n  var parts = language.split('-');\n  var languageCode = language;\n  if (parts.length > 1) {\n    languageCode = parts[0];\n  }\n  if (supportedLanguages.indexOf(languageCode) > -1) {\n    return languageCode;\n  }\n  return null;\n}\n\nMapboxLanguage.prototype.onAdd = function (map) {\n  this._map = map;\n  this._map.on('styledata', this._initialStyleUpdate);\n  this._container = document.createElement('div');\n  return this._container;\n};\n\nMapboxLanguage.prototype.onRemove = function () {\n  this._map.off('styledata', this._initialStyleUpdate);\n  this._map = undefined;\n};\n\nfunction ie11Polyfill() {\n  if (typeof Object.assign != 'function') {\n    // Must be writable: true, enumerable: false, configurable: true\n    Object.defineProperty(Object, 'assign', {\n      // eslint-disable-next-line no-unused-vars\n      value: function assign(target, varArgs) { // .length of function is 2\n        // eslint-disable-next-line strict\n        'use strict';\n        if (target === null) { // TypeError if undefined or null\n          throw new TypeError('Cannot convert undefined or null to object');\n        }\n\n        var to = Object(target);\n\n        for (var index = 1; index < arguments.length; index++) {\n          var nextSource = arguments[index];\n\n          if (nextSource !== null) { // Skip over if undefined or null\n            for (var nextKey in nextSource) {\n              // Avoid bugs when hasOwnProperty is shadowed\n              if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n                to[nextKey] = nextSource[nextKey];\n              }\n            }\n          }\n        }\n        return to;\n      },\n      writable: true,\n      configurable: true\n    });\n  }\n}\n\nif (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\n  module.exports = MapboxLanguage;\n} else {\n  ie11Polyfill();\n  window.MapboxLanguage = MapboxLanguage;\n}\n"]},"metadata":{},"sourceType":"script"}